import { BJShell } from "."
import fs from "fs/promises"
import { existsSync } from "fs"
import chalk from "chalk"
import conf from '@/config'
import { spawn, exec, spawnSync } from 'child_process'
import { getLanguages, getProblem, getProblemSet, language, problem, setLanguageCommentMark } from '@/net/parse'
import { parseTestCasesFromLocal, readTemplateFromLocal } from '@/storage/filereader'
import { writeFile, writeMDFile, writeMainTmp } from '@/storage/filewriter'
import { table } from 'table'
import chokidar from 'chokidar'
import { loadFromLocal, saveToLocal } from "@/storage/localstorage"

interface Command {
    desc: string
    alias?: string
    func: () => Promise<void> | void
    important?: boolean
}

export default function acquireAllCommands(that: BJShell, cmd: string, arg: string[]): { [key: string]: Command } {

    async function ls() {
        try {
            const files = await fs.readdir(process.cwd())
            let output = ""
            for (const file of files) {
                const isDir = (await fs.stat(file)).isDirectory()
                output += `${isDir ? chalk.blue(file) : file}   `
            }
            console.log(output)
        } catch (e) {
            if (e instanceof Error) console.log(e.message)
            else console.log(e)
        }
    }

    function cd() {
        try {
            const path = arg[0] ?? ""
            process.chdir(path)
        } catch (e) {
            if (e instanceof Error) console.log(e.message)
            else console.log(e)
        }
    }

    async function logout() {
        await that.user.setToken("")
        await that.user.setAutologin("")
        that.setLoginLock(0)
        console.log("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.")
    }

    async function set(num?: number) {
        let val = num
        if(val === undefined) {
            if (arg.length === 0 && that.user.getQnum() !== 0) val = that.user.getQnum()
            else {
                const tmp_val = parseInt(arg[0])
                if (!isNaN(tmp_val) && tmp_val >= 0) val = tmp_val
            }
            if (!val) {
                console.log("set <question number>")
                return
            }
        }
        const lang = that.findLang()
        if (!lang) {
            console.log("lang ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¨¼ì € ì–¸ì–´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.")
            return
        }
        const question = await getProblem(val, that.user.getCookies())
        if (question === null) {
            console.log("ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ì œ ë²ˆí˜¸ì…ë‹ˆë‹¤!")
            return
        }
        // ASSERT val is valid qnum
        await that.user.setQnum(val)
        console.log(`ë¬¸ì œê°€ ${chalk.yellow(val + ". " + question.title)}ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`)

        let cmark = lang.commentmark ?? ""
        if (!cmark) {
            const result = await new Promise((resolveFunc) => {
                that.r.question("í˜„ì¬ ì–¸ì–´ì˜ ì£¼ì„ ë¬¸ìë¥¼ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. ì£¼ì„ ë¬¸ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. ë§Œì•½ ì…ë ¥ì„ ì•ˆí• ê²½ìš°, ë¬¸ì œ ì •ë³´ í—¤ë”ê°€ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. \n", (answer) => {
                    resolveFunc(answer)
                })
            })
            cmark = result as string
            setLanguageCommentMark(lang.num, cmark)
        }
        const username = await that.user.getUsername()
        const utc = new Date().getTime() + (new Date().getTimezoneOffset() * 60 * 1000);
        const KR_TIME_DIFF = 9 * 60 * 60 * 1000;
        const kr_curr = new Date(utc + (KR_TIME_DIFF));
        const commentHeader = cmark ? `${cmark}
${cmark}        ${question.qnum}. ${question.title} <${conf.URL}${conf.PROB}${question.qnum}>
${cmark}        
${cmark}        By: ${username} <${conf.URL}${conf.USER}${username}>
${cmark}        Language: ${lang.name ?? ""}
${cmark}        Created at: ${kr_curr.toLocaleString()}
${cmark}        
${cmark}        Auto-generated by BJShell
${cmark}
`
            : ""
        await writeMDFile(question)
        const extension = lang.extension ?? ""
        const filepath = `${process.cwd()}/${question.qnum}${extension}`
        const langTemplate = (await readTemplateFromLocal(extension)) ?? ""

        if (await writeFile(filepath, commentHeader + langTemplate)) console.log(`${chalk.green(filepath)}ì— ìƒˆë¡œìš´ ë‹µì•ˆ íŒŒì¼ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.`)
        else console.log("íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤! ì´ì „ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.")
        exec(`code ${filepath}`)
    }

    function show() {
        exec(`code ${conf.MDPATH}`)
        if (that.firstshow) {
            that.firstshow = false
                console.log("VSCodeì— ë¬¸ì œ íŒŒì¼ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.")
                console.log("â€» ë§Œì•½ ë¬¸ì œ MD íŒŒì¼ì´ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤ë©´, ... ë²„íŠ¼ì„ í´ë¦­ í›„ 'Refresh Preview' ë²„íŠ¼ì„ í´ë¦­í•´ ì£¼ì„¸ìš”." )
                console.log("â€» ë§Œì•½ ë¯¸ë¦¬ë³´ê¸°ê°€ ì•„ë‹Œ ì½”ë“œê°€ ë³´ì¸ë‹¤ë©´ VSCode ìƒì—ì„œ ë‹¤ìŒ ì„¤ì •ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.")
                console.log(`
1. "Ctrl+Shift+P" ë¥¼ ëˆ„ë¥´ì„¸ìš”
2. "Preferences: Open User Settings (JSON) ë¥¼ í´ë¦­í•˜ì„¸ìš”."
3. json íŒŒì¼ì˜ ë§ˆì§€ë§‰ } ì´ì „ì— ë‹¤ìŒ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
    , // don't forget the comma
    "workbench.editorAssociations": {   
        "*.md": "vscode.markdown.preview.editor",
    }
`)
        }
    }

    async function execInBJ() {
        if (arg.length === 0) {
            console.log("exec <command>")
            return
        }
        // https://velog.io/@dev2820/nodejs%EC%9D%98-%EC%9E%90%EC%8B%9D%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4
        // https://kisaragi-hiu.com/nodejs-cmd/
        // FIXME: stdio full sync

        const command = arg.join(' ')
        that.r.setPrompt('')
        that.cp = spawn(command, [], { shell: true })
        await new Promise((resolveFunc) => {
            that.cp!.stdout?.on("data", (x: string) => {
                process.stdout.write(x.toString());
            });
            that.cp!.stderr?.on("data", (x: string) => {
                process.stderr.write(x.toString());
            });
            that.cp!.on("exit", (code: number) => {
                resolveFunc(code);
            });
        });
        that.cp = null
    }

    async function _checkInfo(): Promise<[problem, language] | null> {
        const question = await getProblem(that.user.getQnum())
        if (question === null) {
            console.log("ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ì œ ë²ˆí˜¸ì…ë‹ˆë‹¤!")
            return null
        }
        const lang = that.findLang()
        if (lang === undefined) {
            console.log("lang ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¨¼ì € ì–¸ì–´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.")
            return null
        }
        return [question, lang]
    }

    async function test(hideTitle?: boolean) {
        const info = await _checkInfo()
        if (!info) return
        const [question, lang] = info
        if (!hideTitle) console.log(`===== í…ŒìŠ¤íŠ¸: ${question.qnum}. ${question.title} =====`)
        let success: number = 0
        const extension = lang.extension ?? ""
        const filepath = `${process.cwd()}/${question.qnum}${extension}`
        if (!await writeMainTmp(filepath, extension)) return

        // ask compile
        // const doCompile = await new Promise((resolveFunc) => {
        //     that.r.question("Compile? (y/n) ", (answer) => {
        //         resolveFunc(answer === 'y')
        //     })
        // })
        if (lang.compile && !lang.run.includes('Main' + extension)) {
            const result = spawnSync(lang.compile.split(" ")[0], [...lang.compile.split(" ").slice(1)], {
                cwd: conf.TESTPATH
            })
            if (result.status !== 0) {
                console.log(`${lang.compile}: ${chalk.red("ì»´íŒŒì¼ ì—ëŸ¬!")}`)
                console.log(result.stderr?.toString())
                return
            }
        }

        const localtestcases = await parseTestCasesFromLocal(filepath)
        const testcases = [...question.testcases, ...localtestcases]
        for (const i in testcases) {
            const prefix = parseInt(i) >= question.testcases.length ? "(ì»¤ìŠ¤í…€) í…ŒìŠ¤íŠ¸ #" : "í…ŒìŠ¤íŠ¸ #"
            const t = testcases[i]
            const expected = t.output.replace(/\r\n/g, '\n')
            // default timelimit: stat.timelimit * 2
            // TODO: timelimit from language
            const timelimit: number = parseInt((question.stat.timelimit.match(/\d+/) ?? ["2"])[0]) * 2
            // FIXME: javascript error - using /dev/stdin returns ENXIO: no such device or address, open '/dev/stdin'
            const result = spawnSync(lang.run.split(" ")[0], [...lang.run.split(" ").slice(1)], {
                input: t.input,
                cwd: conf.TESTPATH,
                timeout: timelimit * 1000
            })
            if (result.signal === "SIGTERM") console.log(chalk.red(`${prefix}${i} : ì‹œê°„ ì´ˆê³¼! â° ( > ${timelimit} sec )`))
            else if (result.status !== 0) {
                console.log(chalk.red(`${prefix}${i} : ì—ëŸ¬! âš `))
                console.log(result.stderr?.toString())
            } else {
                const actual = String(result.stdout).replace(/\r\n/g, '\n')
                if (actual.trim() == expected.trim()) {
                    console.log(chalk.green(`${prefix}${i} : í†µê³¼! âœ…`))
                    success += 1
                }
                else {
                    console.log(chalk.red(`${prefix}${i} : ì‹¤íŒ¨! âŒ`))
                    console.log(`ì˜ˆìƒ ì •ë‹µ: ${expected.trim()}`);
                    console.log(`ì‹¤í–‰ ê²°ê³¼: ${actual.trim()}`);
                }
            }
        }
        if (success === testcases.length) console.log(chalk.green("ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤! ğŸ‰"))
        else console.log(chalk.yellow(`${success} / ${testcases.length} ê°œì˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤.`));
    }

    async function testWatch() {
        const info = await _checkInfo()
        if (!info) return
        const [question, lang] = info
        console.log(`===== Test: ${question.qnum}. ${question.title} =====`)
        const extension = lang.extension ?? ""
        const filepath = `${process.cwd()}/${question.qnum}${extension}`

        if (!existsSync(filepath)) {
            console.log("íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!")
            return
        }

        await new Promise((resolveFunc) => {
            console.log(filepath)
            const monitor = chokidar.watch(filepath, { persistent: true })
            that.monitor = monitor
            monitor.on("change", async function (f) {
                if (f.includes(`${question.qnum}${extension}`)) {
                    console.log()
                    console.log(chalk.yellow(`íŒŒì¼ ${f.split("/").pop()} ê°€ ë³€ë™ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ í•©ë‹ˆë‹¤...`))
                    await test(true)
                }
            })
            resolveFunc(0)
        })

        that.changelineModeToKeypress(async (key, data) => {
            if (data.name === 'x') {
                await that.revertlineModeFromKeypress()
            } else if (data.name === 'b') {
                console.log()
                await submit()
            }
        })

        await test(true)
        console.log()
        console.log(chalk.yellow("íŒŒì¼ì´ ë³€ë™ë  ë•Œê¹Œì§€ ê°ì‹œí•©ë‹ˆë‹¤..."))
        console.log(chalk.yellow("ë§Œì•½ ê°ì‹œë¥¼ ì¤‘ë‹¨í•˜ê³  ì‹¶ë‹¤ë©´, Ctrl+Cë¥¼ ëˆ„ë¥´ê±°ë‚˜ xë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤."))
    }

    async function lang() {
        if (arg[0] == 'list') {
            const rawint = parseInt(arg[1])
            const col_num = isNaN(rawint) ? 3 : rawint
            const data = []
            const langs = await getLanguages()
            for (let i = 0; i < langs.length; i += col_num) {
                const row = []
                for (let j = 0; j < col_num; j++) {
                    row.push(langs[i + j]?.name ?? "")
                    row.push(langs[i + j]?.extension ?? "")
                    row.push(langs[i + j]?.num ?? "")
                }
                data.push(row)
            }
            console.log(table(data, { drawVerticalLine: i => i % 3 === 0 }))
            console.log(`ì›í•˜ëŠ” ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ${chalk.blueBright("lang <language number>")}ë¥¼ íƒ€ì´í•‘í•˜ì„¸ìš”.`)
            console.log(`ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì—, ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ ì–¸ì–´ ì„¤ì •ì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ì„¸ìš”. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ${chalk.blueBright(conf.LANGPATH)} íŒŒì¼ì˜ \`compile\` ê³¼ \`run\` ëª…ë ¹ì–´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë°”ê¿”ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.`)
            return
        }
        if (arg.length !== 1 || isNaN(parseInt(arg[0]))) {
            console.log("lang <language number>")
            console.log("ì–¸ì–´ ëª©ë¡ì„ ë³´ê³  ì‹¶ë‹¤ë©´ lang listë¥¼ íƒ€ì´í•‘í•˜ì„¸ìš”.")
            return
        } else if (!that.findLang(parseInt(arg[0]))) {
            console.log("ìœ íš¨í•˜ì§€ ì•Šì€ ì–¸ì–´ ë²ˆí˜¸ì…ë‹ˆë‹¤.")
            return
        }
        await that.user.setLang(parseInt(arg[0]))
    }

    async function submit() {
        const info = await _checkInfo()
        if (!info) return
        const [question, _] = info
        that.r.pause()
        try {
            console.log(`===== ì œì¶œ: ${question!.qnum}. ${question!.title} =====`)
            const filepath = `${process.cwd()}/${that.user.getQnum()}${that.findLang()?.extension ?? ""}`
            const code = await fs.readFile(filepath, 'utf-8')
            const subId = await that.user.submit(code)
            if (subId === -1) return
            console.log(`ë¬¸ì œë¥¼ ì œì¶œí–ˆìŠµë‹ˆë‹¤!`)
            for (let sec = 0; sec < 60; sec++) {
                const result = await that.user.submitStatus(subId)
                if (result === null) {
                    console.log(`ì œì¶œë²ˆí˜¸ ${subId} ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`)
                    return
                }
                const result_num = parseInt(result.result)
                if (isNaN(result_num)) {
                    console.log(`ì œì¶œë²ˆí˜¸ ${subId} ê²°ê³¼ë¥¼ íŒŒì‹±í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`)
                    return
                }
                process.stdout.clearLine(0);
                process.stdout.cursorTo(0);
                if (result_num >= 4) {
                    const info = result_num === 4 ?
                        `${chalk.green(result.result_name)} | Time: ${result.time} ms | Memory: ${result.memory} KB` :
                        `${chalk.red(result.result_name)}`
                    console.log(info)
                    const username = await that.user.getUsername()
                    const langcode = that.findLang()?.num
                    console.log(`\n=> ${conf.URL}status?problem_id=${question!.qnum}&user_id=${username}&language_id=${langcode}&result_id=-1`)
                    break
                }
                process.stdout.write(`${result.result_name} (${sec} s passed)`); // end the line
                await new Promise(resolve => setTimeout(resolve, 1000))
            }
        } catch (e) {
            if (e instanceof Error) console.log(e.message)
            else console.log(e)
        } finally {
            that.r.resume()
        }
    }


    async function probset() {
        // if(arg[0] == )
        switch(arg[0]) {
            case 'set':
            case 's': {
                if(arg.length == 1) {
                    console.log("probset set <number>")
                    return
                }
                const probsObj = await loadFromLocal("ps")
                if(!probsObj) {
                    console.log("ì €ì¥ëœ ë¬¸ì œ ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                const val = parseInt(arg[1])
                if (isNaN(val) || val < 0 || val >= probsObj.probset.length) {
                    console.log("probset set <number>")
                    return
                }
                await set(probsObj.probset[val][0])
                break
            }
            case 'clear':
            case 'c': {
                await saveToLocal("ps", undefined)
                console.log("ë¬¸ì œ ì…‹ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.")
                break
            }
            case 'next':
            case 'n': {
                const probsObj = await loadFromLocal("ps")
                if(!probsObj) {
                    console.log("ì €ì¥ëœ ë¬¸ì œ ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                const qnum = that.user.getQnum()
                const idx = probsObj.probset.findIndex((x: [number, string]) => x[0] == qnum)
                if(idx == -1) {
                    console.log("í˜„ì¬ ë¬¸ì œê°€ ì €ì¥ëœ ë¬¸ì œ ì…‹ì— ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                if(idx == probsObj.probset.length - 1) {
                    console.log("ë§ˆì§€ë§‰ ë¬¸ì œì…ë‹ˆë‹¤.")
                    return
                }
                await set(probsObj.probset[idx + 1][0])
                break
            }
            case 'prev':
            case 'p': {
                const probsObj = await loadFromLocal("ps")
                if(!probsObj) {
                    console.log("ì €ì¥ëœ ë¬¸ì œ ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                const qnum = that.user.getQnum()
                const idx = probsObj.probset.findIndex((x: [number, string]) => x[0] == qnum)
                if(idx == -1) {
                    console.log("í˜„ì¬ ë¬¸ì œê°€ ì €ì¥ëœ ë¬¸ì œ ì…‹ì— ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                if(idx == 0) {
                    console.log("ì²«ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.")
                    return
                }
                await set(probsObj.probset[idx - 1][0])
                break
            }
            case 'list':
            case 'l': {
                const probsObj = await loadFromLocal("ps")
                if(!probsObj) {
                    console.log("ì €ì¥ëœ ë¬¸ì œ ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                const data = []
                data.push(["ë²ˆí˜¸", "ì œëª©"])
                console.log(`${probsObj.title}: ë¬¸ì œ ${probsObj.probset.length}ê°œ`)
                for(const prob of probsObj.probset) {
                    const qnum = prob[0]
                    const title = prob[1]
                    if(qnum == that.user.getQnum()) {
                        data.push([chalk.green(qnum), chalk.green(title)])
                    } else {
                        data.push([qnum, title])
                    }
                }
                console.log(table(data))
                break
            }
            default: {
                const urlReg = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/
                if(!urlReg.test(arg[0])) {
                    console.log("ì˜¬ë°”ë¥¸ URLì´ ì•„ë‹™ë‹ˆë‹¤.")
                    return
                }
                const probset = await getProblemSet(arg[0])
                if(probset.length == 0) {
                    console.log("ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.")
                    return
                }
                const probsetTitle = arg[1] ? arg.slice(1).join(' ') : 'My Problem Set'
                const probsObj = {
                    title: probsetTitle,
                    probset
                }
                await saveToLocal("ps", probsObj)
                console.log(`${probsetTitle}: ë¬¸ì œ ${probset.length}ê°œë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤.`)
                console.log("ì²«ë²ˆì§¸ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...")

                await set(probset[0][0])
                break
            }
        }

    }

    function help(commands: { [key: string]: Command }) {
        if (arg[0] == 'all') {
            const data = []
            data.push(["ë‹¨ì¶•ì–´", "ëª…ë ¹ì–´", "ì„¤ëª…"])
            for (const key in commands) {
                const cmd = commands[key]
                data.push([cmd.alias ?? "", key, cmd.desc])
            }
            console.log(table(data))
        } if (arg[0] == 'testcase')  {
            console.log(
`${chalk.yellow("ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë¬¸ë²• ì„¤ëª…")}
ê° ì–¸ì–´ì˜ ì£¼ì„ì— <BJTestcase> </BJTestcase> íƒœê·¸ ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤. í•´ë‹¹ íƒœê·¸ ë°–ì— ìˆëŠ” í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
ì£¼ì„ì˜ ì¢…ë¥˜(ë¼ì¸, ë¸”ë¡)ëŠ” ìƒê´€ì—†ìœ¼ë©° , íƒœê·¸ì˜ ëŒ€ì†Œë¬¸ìëŠ” êµ¬ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
í•´ë‹¹ íƒœê·¸ ì•ˆì— ìˆëŠ” ì¼ë°˜ ë¬¸ìë“¤ì€ ë¬´ì‹œë©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ë¥¼ ì„¤ëª…í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•´ë‹¹ íƒœê·¸ ì•ˆì— ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ ì…ì¶œë ¥ ìŒì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    << ì™€ -- ì‚¬ì´ì— ìˆëŠ” ë¬¸ì(ê°œí–‰ë¬¸ì í¬í•¨)ëŠ” ì…ë ¥ìœ¼ë¡œ, >> ì™€ -- ëŠ” ì¶œë ¥ ê²°ê³¼ë¡œ ì¸ì‹ë©ë‹ˆë‹¤.
    << í˜¹ì€ -- ë‹¤ìŒì— ì˜¤ëŠ” ë¬¸ìëŠ” <<, -- ì™€ ë°˜ë“œì‹œ ë“¤ì—¬ì“°ê¸° ê³µë°± (íƒ­) ê°œìˆ˜ë¥¼ ì¼ì¹˜ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.
    << (input) -- (output) >> ê°€ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ì´ë©°, íƒœê·¸ì— ì—¬ëŸ¬ê°œì˜ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ ì‹¤í–‰ ê²°ê³¼ì— (ì»¤ìŠ¤í…€) ì´ë¼ëŠ” ì ‘ë‘ì–´ê°€ ë¶™ìŠµë‹ˆë‹¤.

${chalk.green(`ì˜ˆì‹œ) 1000.py

"""
<BJTestcase>
1. ìŒìˆ˜ê°€ í¬í•¨ëœ ë§ì…ˆ
    <<
    -1 1
    --
    0
    >>

2. í°ìˆ˜ì˜ ë§ì…ˆ
    <<
    999999999999 1
    ---
    1000000000000
    >>
</BJTestcase>
"""
a, b = map(int, input().split())
print(a + b)
`)}
`
            )
        } else if (arg.length === 0) {
            const data = []
            data.push(["ë‹¨ì¶•ì–´", "ëª…ë ¹ì–´", "ì„¤ëª…"])
            for (const key in commands) {
                const cmd = commands[key]
                if(cmd.important) data.push([cmd.alias ?? "", key, cmd.desc])
            }
            console.log(table(data))
            console.log("ëª¨ë“  ëª…ë ¹ì–´ë¥¼ ë³´ë ¤ë©´ 'help all' ë¥¼ íƒ€ì´í•‘í•˜ì„¸ìš”.")
            console.log("ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ ë¬¸ë²•ì„ ë³´ë ¤ë©´ 'help testcase' ë¥¼ íƒ€ì´í•‘í•˜ì„¸ìš”.")
        }
        
    }


    const commands = {
        "help": {
            // desc: "Show help.",
            desc: "ëª…ë ¹ì–´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì „ì²´ ëª…ë ¹ì–´ë¥¼ ë³´ë ¤ë©´ 'help all' ì„ íƒ€ì´í•‘í•˜ì„¸ìš”.",
            func: () => help(commands),
            alias: "h",
            important: true
        },
        "exit": {
            desc: "BJ Shellì„ ì¢…ë£Œí•©ë‹ˆë‹¤.",
            func: () => { that.r.close() },
            alias: "x"
        },
        "pwd": {
            desc: "í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.",
            func: () => { console.log(process.cwd()) }
        },
        "ls": {
            desc: "í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.",
            func: ls
        },
        "cd": {
            desc: "ë””ë ‰í† ë¦¬ë¥¼ ì´ë™í•©ë‹ˆë‹¤. (cd <path>)",
            func: cd
        },
        "logout": {
            desc: "BJ Shellì„ ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤.",
            func: logout
        },
        "set": {
            desc: `VSCodeì—ì„œ ë¬¸ì œ ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ê³  ë‹µì•ˆ íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ê±°ë‚˜ ì—½ë‹ˆë‹¤.
ë˜í•œ ë¬¸ì œ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ì¸ìˆ˜ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
.bjshell/Template/Main.*ì— í…œí”Œë¦¿ íŒŒì¼ì´ ìˆìœ¼ë©´ íŒŒì¼ì„ ë§Œë“¤ ë•Œ í…œí”Œë¦¿ì„ ë¡œë“œí•©ë‹ˆë‹¤.
ì‚¬ìš©ë²•: set <question number> or set`,
            func: set,
            alias: "s",
            important: true
        },
        "show": {
            desc: "VSCodeì—ì„œ ë¬¸ì œ íŒŒì¼(problem.md)ì„ ì—½ë‹ˆë‹¤.",
            func: show,
            alias: "o",
            important: true
        },
        "unset": {
            desc: "í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.",
            func: async () => { await that.user.setQnum(0) }
        },
        "exec": {
            desc: `ì™¸ë¶€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. (ex. exec python3 Main.py) (ex. e rm *.py)
SIGINT(Ctrl+C)ë§Œ ì²˜ë¦¬ë©ë‹ˆë‹¤. íŒŒì´í”„ ë“± ë³µì¡í•œ ì‰˜ ê¸°ëŠ¥ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì‚¬ìš©ë²•: exec <command>`,
            func: execInBJ,
            alias: "e"
        },
        "test": {
            desc: `ë¬¸ì œì—ì„œ ì œê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ëŠ” ë¬¸ì œ íŒŒì¼(problem.md)ì— ê¸°ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ë˜í•œ, ë‹µì•ˆ íŒŒì¼ì— ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ìì„¸í•œ ë‚´ìš©ì€ "help testcase" ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)`,
            func: test,
            alias: "t",
        },
        "watch": {
            desc: `test ëª…ë ¹ì–´ì™€ ë™ì¼í•˜ì§€ë§Œ, íŒŒì¼ ë³€ë™ì„ ê°ì§€í•˜ì—¬ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì¬ì‹¤í–‰í•©ë‹ˆë‹¤.
watch ëª¨ë“œì—ì„œëŠ” "b" ì™€ "x" ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
b: ì¦‰ì‹œ ì œì¶œí•©ë‹ˆë‹¤. (submit ëª…ë ¹ì–´ì™€ ë™ì¼)
x: watch ëª¨ë“œë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤. (Ctrl + C ì™€ ë™ì¼)`,
            func: testWatch,
            alias: "w",
            important: true
        },
        "lang": {
            desc: `ì‚¬ìš© ê°€ëŠ¥í•œ ì–¸ì–´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì–¸ì–´ë¥¼ ì„¤ì •í•˜ë ¤ë©´ lang <ì–¸ì–´ ë²ˆí˜¸> ë¥¼ íƒ€ì´í•‘í•˜ì„¸ìš”.
ì‚¬ìš©ë²•: lang list or lang list <column number>
ì‚¬ìš©ë²•: lang <language number>`,
            func: lang,
            alias: "l",
            important: true
        },
        "submit": {
            desc: `í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ì™€ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ BOJì— ì½”ë“œë¥¼ ì œì¶œí•©ë‹ˆë‹¤.`,
            func: submit,
            alias: "b",
            important: true
        },
        "google": {
            desc: `í˜„ì¬ ë¬¸ì œë¥¼ êµ¬ê¸€ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤. (ë§í¬ ì œê³µ)`,
            func: () => console.log(`https://www.google.com/search?q=%EB%B0%B1%EC%A4%80+${that.user.getQnum()}+${encodeURIComponent(that.findLang()?.name ?? "")}`),
            alias: "g",
        },
        "probset": {
            desc: `URLë¡œë¶€í„° ë°±ì¤€ ë¬¸ì œë“¤ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
ì‚¬ìš©ë²•:
probset <url> <title?> - url ë‚´ ì¡´ì¬í•˜ëŠ” ë°±ì¤€ë¬¸ì œ í•˜ì´í¼ë§í¬ë“¤ì„ íŒŒì‹±í•´ title ì´ë¦„ìœ¼ë¡œ ë¬¸ì œ ì…‹ì„ ì§€ì •í•©ë‹ˆë‹¤.
probset set <number> (or probset s) - në²ˆì§¸ ë¬¸ì œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
probset clear (or probset c)- ì €ì¥ëœ ë¬¸ì œ ì…‹ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. 
probset next (or probset n) - ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.
probset prev (or probset p) - ì´ì „ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.
probset list (or probset l) - ë¬¸ì œ ì…‹ ë‚´ ë¬¸ì œ ë¦¬ìŠ¤íŠ¸ì™€ í˜„ì¬ ì„ íƒëœ ë¬¸ì œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
`,
            func: probset,
            alias: "ps",
        }
    }

    return commands
}